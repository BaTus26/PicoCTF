# Write-up : Web Gauntlet 3
---
### Description :
> Last time, I promise! Only 25 characters this time. Log in as admin Site: http://mercury.picoctf.net:32946/ Filter: http://mercury.picoctf.net:32946/filter.php
### Hint :
> Each filter is separated by a space. Spaces are not filtered.
> There is only 1 round this time, when you beat it the flag will be in filter.php.
> sqlite
---
### Solution :
- Phần gợi ý của bài cho ta biết bài này sử dụng sqlite, vì vậy ta sẽ chú tâm vào các toán tử và các câu truy vấn trong Sqlite

  Bắt đầu bài ta thấy được 1 form yêu cầu nhập `` Username `` và `` Password `` , ngoài ra chúng ta còn biết được form đăng nhập filter những ký tự hay nào nào :
> Filters: or and true false union like = > < ; -- /* */ admin

Sau khi thử các paylaod kinh điển như `` admin'-- `` hay `` ' or 1=1-- `` thì hoàn toàn không được vì đã bị filter hết.

Chúng ta không thể nào dùng các câu truy vấn và từ liên quan đến phần bị filter, sau khi lục tìm các toán tử và các câu truy vấn có thể dùng trong sqlite thì tôi có thấy 1 toán tử khá hay đó là toán tử nối chuỗi `` || `` vì thế tôi nghĩ ra việc chia từ admin thành 2 phần để nối

Tôi thử câu truy vấn mới với cấu trúc là : ``` adm'||'in ```
> Giải thích : vì câu truy vấn của bài là `` SELECT username, password FROM users WHERE username='admin1' AND password='pass' `` , nên khi thay câu truy vấn vào ta có `` SELECT username, password FROM users WHERE username='adm'||'in' AND password='pass' `` thì lúc đó username sẽ nhận giá trị 'admin' từ 2 chuỗi 'adm' + 'in'

Sau khi thử thì không còn thông báo bị ` filter ` nữa mà chuyển thành ` not admin ` , vậy là ta đã vượt qua filter nhưng vấn để lại xuất hiện. Làm sao để là ` admin `, chính xác đó là còn thiếu password
Chúng ta không biết password của bài và cũng không thể dùng `` or 1=1 `` để vượt qua tại vì bị filter đi hết rồi.
Trong khi tìm kiếm thêm toán tử có thể "lách luật" thì tôi đã tìm ra toán tử `` IS NOT `` 
> toán từ `` IS NOT `` dùng để so sánh 2 giá trị

Lợi dụng vào tính chất ta có thể tạo ra 1 biểu thức luôn đúng như là : `` 1' IS NOT '2 `` hoạc `` a' IS NOT 'b `` 
Khi thay vào phần password thì đã vượt qua được được filter và flag được hiển thị trong đường dẫn `` http://mercury.picoctf.net:32946/filter.php `` cùng với code php  
```php
<?php
session_start();

if (!isset($_SESSION["winner3"])) {
    $_SESSION["winner3"] = 0;
}
$win = $_SESSION["winner3"];
$view = ($_SERVER["PHP_SELF"] == "/filter.php");

if ($win === 0) {
    $filter = array("or", "and", "true", "false", "union", "like", "=", ">", "<", ";", "--", "/*", "*/", "admin");
    if ($view) {
        echo "Filters: ".implode(" ", $filter)."<br/>";
    }
} else if ($win === 1) {
    if ($view) {
        highlight_file("filter.php");
    }
    $_SESSION["winner3"] = 0;        // <- Don't refresh!
} else {
    $_SESSION["winner3"] = 0;
}

// picoCTF{k3ep_1t_sh0rt_ef4a5b40aa736f5016b4554fecb568d0}
?>
```
### Flag : `` picoCTF{k3ep_1t_sh0rt_ef4a5b40aa736f5016b4554fecb568d0} ``
